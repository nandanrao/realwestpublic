"use strict";angular.module("realwestfest",["ngAnimate","ngTouch","ui.router","ngMaterial"]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("blue").accentPalette("grey")}]),angular.module("realwestfest").controller("VenuesCtrl",["$scope","$location","$anchorScroll","venues",function(e,t,n,i){console.log(t.hash()),n(),i.onValue(function(t){e.venues=t})}]),angular.module("realwestfest").factory("utils",function(){var e={};return e.uuid=function(){var e=Date.now(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:7&n|8).toString(16)});return t},e}),angular.module("realwestfest").factory("toast",["$mdToast",function(e){var t=function(t){e.show(e.simple().content(t).position("top right").hideDelay(1500))};return t}]),angular.module("realwestfest").directive("dayInSchedule",function(){return{templateUrl:"app/schedule/partials/dayinschedule.html",restrict:"E",scope:{allEvents:"=events",date:"="},link:function(e){var t=function(e,t){return _.filter(e,function(e){var n=Number(e.startTime),i=new Date(n);return i.getDate()===t})};e.events=t(e.allEvents,e.date)}}}),angular.module("realwestfest").controller("scheduleCtrl",["$scope","events",function(e,t){e.events=t}]),angular.module("realwestfest").directive("listing",["Venue",function(e){return{templateUrl:"app/listing/partials/listing.html",restrict:"E",replace:!0,controllerAs:"listing",link:function(t){t.venues=[],t.event.venue?(t.times=[],t.times.push(t.event),e.getVenueById(t.event.venue).then(function(e){t.venues.push(e)})):t.event.times&&t.event.times[0].venue&&(t.times=t.event.times,_.each(t.event.times,function(n){e.getVenueById(n.venue).then(function(e){t.venues.push(e)})})),console.log(t)}}}]),angular.module("realwestfest").factory("fb",function(){var e=new Firebase("https://realwestfest.firebaseio.com");return e}),angular.module("realwestfest").factory("Event",["$q","fb",function(e,t){var n=t.child("events");return{getEvents:function(){return e(function(e){var t=Kefir.fromEvent(n,"value").map(function(e){return e.val()}).map(_.values.bind(this));t.onValue(function(n){e(t.toProperty(n))})})},getEventsByTime:function(){return e(function(e){n.once("value",function(t){var n=t.val();console.log(n),e(_.flatten(_.map(n,function(e){return _.map(e.times,function(t){return _.assign(_.clone(e),t)})})))})})},getEventById:function(t){return e(function(e){n.child(t).once("value",function(t){var n=t.val()||{_id:t.key()};e(n)})})},updateEvent:function(t,i){return e(function(e,a){n.child(t._id).update(i,function(t){return t?a(t):e()})})},remove:function(t){return e(function(e,i){n.child(t).remove(function(t){return t?i(t):e()})})},newEvent:function(){return n.push().key()}}}]),angular.module("realwestfest").controller("EventsCtrl",["$scope","events",function(e,t){t.onValue(function(t){e.events=_.groupBy(t,"type"),e.eventTypes=_.keys(e.events).sort()})}]),angular.module("realwestfest").factory("imageResize",["$q",function(e){var t={};return t.resize=function(t,n){var i=e.defer(),a=new Image;a.src=t;var r=a.naturalWidth,l=a.naturalHeight,s=n,u=Math.floor(l/r*s),o=document.createElement("canvas"),c=o.getContext("2d");o.width=r,o.height=l,c.drawImage(a,0,0,r,l);var d=document.createElement("canvas");return d.width=s,d.height=u,pica.resizeCanvas(o,d,{quality:2},function(e){if(e)return i.reject(e);var t="image/jpeg",n=d.toDataURL(t);i.resolve(n)}),i.promise},t}]),angular.module("realwestfest").factory("eventInterface",function(){var e={_id:null,name:{type:"string",field:"input"},description:{type:"string",field:"textarea"},url:{type:"url",field:"input"},image:{type:"file",field:"file"}},t=_.assign(e,{duration:{type:"number",field:"input"},year:{type:"string",field:"input"},director:{type:"string",field:"input"},trailer:{type:"url",field:"input"}});return{film:t}}),angular.module("realwestfest").directive("uploadImage",["$q","imageResize",function(e,t){return{template:'<input type="file" />',restrict:"E",replace:!0,controllerAs:"upload",scope:{model:"=ngModel"},link:function(n,i){function a(t){return e(function(e,n){/^image\//.test(t.type)||n(new Error("not an image!"));var i=new FileReader;i.onload=function(t){e(t.target.result)},i.readAsDataURL(t)})}i.bind("change",function(){var e=i[0].files[0];a(e).then(_.partialRight(t.resize,600)).then(function(e){n.model=e})})}}}]),angular.module("realwestfest").directive("timeInput",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){i.$parsers.push(function(e){return chrono.parseDate(e).getTime()}),i.$formatters.push(function(e){if(!e)return void 0;var t=new Date(Number(e));return t.toString()})}}}),angular.module("realwestfest").directive("editEvent",["Venue",function(){return{template:'<add-image event="event"></add-image>                 <div ng-include="contentUrl"></div>                 <add-time event="event"></add-time>',restrict:"E",scope:{event:"="},link:function(e,t,n){var i={film:"edit-film.html",music:"edit-music.html",special:"edit-special.html"};e.contentUrl="app/cms/partials/"+i[n.type]}}}]).directive("description",function(){return{template:'<md-input-container>                 <label for="">Description</label>                 <textarea ng-model="event.description"></textarea>                 </md-input-container>',restrict:"EA"}}).directive("name",function(){return{template:'<md-input-container>                 <label for="">Name</label>                 <input type="text" ng-model="event.name"/>                 </md-input-container>',restrict:"EA"}}).directive("artists",function(){return{template:'<md-input-container>                 <label for="">Artist(s)</label>                 <input type="text" ng-model="event.artists"/>                 </md-input-container>',restrict:"EA"}}).directive("duration",function(){return{template:'<md-input-container>                 <label for="">Duration in minutes</label>                 <input type="text" ng-model="event.duration" />                 </md-input-container>',restrict:"EA"}}).directive("year",function(){return{template:'<md-input-container>                 <label for="">Year</label>                 <input type="text" ng-model="event.year"/>                 </md-input-container>',restrict:"EA"}}).directive("homepage",function(){return{template:'<md-input-container>                 <label for="">Homepage</label>                 <input type="text" ng-model="event.homepage"/>                 </md-input-container>',restrict:"EA"}}).directive("bandcamp",function(){return{template:'<md-input-container>                 <label for="">Bandcamp</label>                 <input type="text" ng-model="event.bandcamp"/>                 </md-input-container>',restrict:"EA"}}).directive("facebook",function(){return{template:'<md-input-container>                 <label for="">Facebook</label>                 <input type="text" ng-model="event.facebook"/>                 </md-input-container>',restrict:"EA"}}).directive("price",function(){return{template:'<md-input-container>                 <label for="">Price</label>                 <input type="text" ng-model="event.price"/>                 </md-input-container>',restrict:"EA"}}),angular.module("realwestfest").directive("cmsNavbar",["$state",function(e){return{templateUrl:"app/cms/partials/cms-navbar.html",restrict:"E",controller:function(){},link:function(){console.log(e)}}}]),angular.module("realwestfest").directive("addTime",["Venue",function(e){return{templateUrl:"app/cms/partials/add-time.html",restrict:"E",scope:{event:"="},controllerAs:"addtime",controller:["$scope",function(e){this.addTime=function(){e.event.times=e.event.times||[],e.event.times.push({startTime:null,venue:null})},this.deleteTime=function(t){e.event.times.splice(t,1)}}],link:function(t){e.getVenues().then(function(e){e.onValue(function(e){t.venues=e})})}}}]),angular.module("realwestfest").directive("addImage",function(){return{template:'<h3>Image</h3> 								<img ng-if="event.image" ng-src="{{ event.image }}" alt=""> 								<md-input-container> 								<upload-image ng-model="event.image"></upload-image> 								</md-input-container>',restrict:"E",scope:{event:"="}}}),angular.module("realwestfest").controller("editVenueCtrl",["$scope","$state","venue","Venue",function(e,t,n,i){e.venue=angular.copy(n),e.venue.type="venue",this.saveVenue=function(){i.updateVenue(n,e.venue)},this.delete=function(){i.remove(n._id).then(function(){console.log("removed")}),t.go("cms")}}]),angular.module("realwestfest").controller("editFilmCtrl",["$scope","event",function(e,t){e.event=t,e.venues=Venue.getVenues(),this.getVenueName=Venue.getVenueName}]),angular.module("realwestfest").controller("editCtrl",["$scope","$stateParams","$state","event","Event","utils","toast",function(e,t,n,i,a,r,l){e.eventInfo=angular.copy(i),e.type=t.type,e.eventInfo.type=e.type,this.saveEvent=function(){a.updateEvent(i,e.eventInfo).then(function(){l("Updates Saved!")})},this.delete=function(){a.remove(i._id).then(function(){console.log("removed")}),n.go("cms")}}]),angular.module("realwestfest").controller("cmsCtrl",["$scope","$state","events","venues","Event","Venue",function(e,t,n,i,a,r){n.onValue(function(t){e.filmEvents=_.filter(t,function(e){return"film"===e.type}),e.musicEvents=_.filter(t,function(e){return"music"===e.type}),e.specialEvents=_.filter(t,function(e){return"special"===e.type})}),i.onValue(function(t){e.venues=t}),this.newevent=function(e){var n=a.newEvent();t.go("cms.edit-event",{id:n,type:e})},this.newvenue=function(){var e=r.newVenue();console.log(e),t.go("cms.edit-venue",{id:e})}}]),angular.module("realwestfest").controller("aboutCtrl",["$scope",function(e){e.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("realwestfest").factory("Venue",["$q","fb",function(e,t){var n=t.child("venues"),i={};return i.getVenues=function(){return e(function(e){var t=Kefir.fromEvent(n,"value").map(function(e){return e.val()}).map(_.values.bind(this));t.onValue(function(n){e(t.toProperty(n))})})},i.getVenueById=function(t){if(!t)throw new Error("need an id");return e(function(e){n.child(t).once("value",function(t){var n=t.val()||{_id:t.key()};e(n)})})},i.updateVenue=function(t,i){return e(function(e,a){n.child(t._id).update(i,function(t){return t?a(t):e()})})},i.remove=function(t){return e(function(e,i){n.child(t).remove(function(t){return t?i(t):e()})})},i.newVenue=function(){return n.push().key()},i}]),angular.module("realwestfest").factory("AttractionsFactory",["fb",function(e){var t={};return t.ref=e.child("attractions"),t.getAllAttractions=function(){var e=Kefir.fromEvent(t.ref,"value").toProperty();return e},t.getAttractionByScreening=function(){},t}]),angular.module("realwestfest").controller("footerCtrl",["$scope",function(e){e.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("realwestfest").controller("MainCtrl",["$scope","Venue","Event",function(e,t,n){n.getEvents().then(function(){console.log("eventsLoaded")})}]),angular.module("realwestfest").controller("NavbarCtrl",["$scope",function(e){e.date=new Date}]),angular.module("realwestfest").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"}).state("schedule",{url:"/schedule",templateUrl:"app/schedule/partials/schedule.html",controller:"scheduleCtrl as schedule",resolve:{events:["Event",function(e){return e.getEventsByTime()}]}}).state("events",{url:"/events",templateUrl:"app/events/partials/events.html",controller:"EventsCtrl as eventsCtrl",resolve:{events:["Event",function(e){return e.getEvents()}]}}).state("venues",{url:"/venues#:id",templateUrl:"app/venues/partials/venues.html",controller:"VenuesCtrl as venuesCtrl",resolve:{venues:["Venue",function(e){return e.getVenues()}]}}).state("about",{url:"/about",templateUrl:"app/about/partials/about.html",controller:"aboutCtrl as about"}).state("cms",{url:"/cms",templateUrl:"app/cms/partials/cms.html",controller:"cmsCtrl as cms",resolve:{events:["Event",function(e){return e.getEvents()}],venues:["Venue",function(e){return e.getVenues()}]}}).state("cms.edit-event",{url:"/edit/:type/:id",templateUrl:"app/cms/partials/edit.html",controller:"editCtrl as edit",resolve:{event:["Event","$stateParams",function(e,t){return e.getEventById(t.id)}]}}).state("cms.edit-venue",{url:"/edit/venue/:id",templateUrl:"app/cms/partials/edit-venue.html",controller:"editVenueCtrl as edit",resolve:{venue:["Venue","$stateParams",function(e,t){return e.getVenueById(t.id)}]}}),t.otherwise("/")}]),angular.module("realwestfest").run(["$templateCache",function(e){e.put("components/navbar/navbar.html",'<div class="hero"><div class="header"><div class="logo"><a ui-sref="home"><img src="assets/images/Pendleton_logo_black.svg" alt=""></a></div><nav><ul><li ui-sref-active="active"><a ui-sref="schedule">schedule</a></li><li ui-sref-active="active"><a ui-sref="events">events</a></li><li ui-sref-active="active"><a ui-sref="about">about</a></li></ul></nav></div></div>'),e.put("app/main/main.html",'<div id="home"><header ng-include="\'components/navbar/navbar.html\'"></header><div class="email"><h2>April 16<sup>th</sup> â€“ 18<sup>th</sup>, 2015</h2><h2>enter your email & stay posted</h2><form action="//realwestfest.us10.list-manage.com/subscribe/post?u=7bdcb2538fed142a04ff4d38f&amp;id=d1acd88e4e" method="post" class="validate" target="_blank" novalidate=""><input type="email" name="EMAIL" required=""><div style="position: absolute; left: -5000px;"><input type="text" name="b_7bdcb2538fed142a04ff4d38f_d1acd88e4e" tabindex="-1" value=""></div><button>submit</button></form><div class="social"><a href="http://facebook.com/realwestfest" target="_blank"><img src="assets/images/facebook-square.svg" alt=""></a> <a href="http://twitter.com/realwestfest" target="_blank"><img src="assets/images/twitter.svg" alt=""></a></div></div></div>'),e.put("app/about/partials/about.html",'<div id="about"><header ng-include="\'components/navbar/navbar.html\'"></header><div class="content"><p>Pendleton, Oregon is a city with a rich history of craftsmanship, a world class rodeo and an abundance of civic pride. This heritage is woven into the Pendleton Real West Festival and naturally informs its character. This celebration of classic western cinema and music also embraces voices of Native Americans and contemporary artists of the West.</p></div><footer ng-include="\'components/footer/partials/footer.html\'"></footer></div>'),e.put("components/footer/partials/footer.html",'<nav><ul><li><a href="mailto:realwestfest@gmail.com">email</a></li><li>541.979.9714</li></ul></nav>'),e.put("app/cms/partials/add-time.html",'<div class="add-time"><h2>Events:</h2><div class="event-time" ng-repeat="time in event.times track by $index"><md-input-container><label for="">Time</label> <input time-input="" type="text" placeholder="i.e. April 7th at 5pm" ng-model="time.startTime" ng-model-options="{ updateOn: \'blur\'}"></md-input-container><div class="input-container"><label>Venue</label><select ng-model="time.venue" ng-options="venue._id as venue.name for venue in venues"><option value="">No Venue Yet</option></select></div><md-input-container><label>EventBrite Link</label> <input type="text" ng-model="time.ticketlink"></md-input-container><button type="button" class="remove-event" ng-click="addtime.deleteTime($index)">remove</button></div><button type="button" class="add-event" ng-click="addtime.addTime()">add an event</button></div>'),e.put("app/cms/partials/cms-navbar.html",""),e.put("app/cms/partials/cms.html",'<div id="cms"><md-sidenav md-component-id="cms-nav" md-is-locked-open="$mdMedia(\'gt-md\')"><div class="eventlist"><ul><li>Events<ul><li>Films<ul><li ui-sref-active="active" ng-repeat="event in filmEvents" class="eventlink"><a ui-sref="cms.edit-event({ id: event._id, type: \'film\' })">{{ event.name }}</a></li><li><a href="#" ng-click="cms.newevent(\'film\')">+ Film</a></li></ul></li><li>Music<ul><li ui-sref-active="active" ng-repeat="event in musicEvents" class="eventlink"><a ui-sref="cms.edit-event({ id: event._id, type: \'music\' })">{{ event.name }}</a></li><li><a href="#" ng-click="cms.newevent(\'music\')">+ Music</a></li></ul></li><li>Special<ul><li ui-sref-active="active" ng-repeat="event in specialEvents" class="eventlink"><a ui-sref="cms.edit-event({ id: event._id, type: \'special\' })">{{ event.name }}</a></li><li><a href="#" ng-click="cms.newevent(\'special\')">+ Special</a></li></ul></li></ul></li><li>Venues<ul><li ui-sref-active="active" ng-repeat="venue in venues" class="eventlink"><a ui-sref="cms.edit-venue({ id: venue._id, type: \'venue\' })">{{ venue.name }}</a></li><li><a href="#" ng-click="cms.newvenue()">+ Venue</a></li></ul></li><li>Other</li></ul></div></md-sidenav><ui-view></ui-view></div>'),e.put("app/cms/partials/edit-film.html","<name></name><artists></artists><duration></duration><year></year><homepage></homepage><description></description>"),e.put("app/cms/partials/edit-music.html","<name></name><artists></artists><homepage></homepage><bandcamp></bandcamp><facebook></facebook><description></description>"),e.put("app/cms/partials/edit-special.html","<name></name><price></price><description></description>"),e.put("app/cms/partials/edit-venue.html",'<form class="editevent" ng-submit="edit.saveVenue()"><md-input-container><label for="">Name</label> <input type="text" ng-model="venue.name"></md-input-container><md-input-container><label for="">Address</label> <input type="text" ng-model="venue.address"></md-input-container><md-input-container><label for="">Google Maps Link</label> <input type="text" ng-model="venue.googlemaps"></md-input-container><md-input-container><label for="">Description</label> <textarea ng-model="venue.description"></textarea></md-input-container><div class="edit-buttons"><button>SAVE</button> <button type="button" class="delete" ng-click="edit.delete()">DELETE</button></div></form>'),e.put("app/cms/partials/edit.html",'<form class="editevent" ng-submit="edit.saveEvent()"><edit-event event="eventInfo" type="{{ type }}"></edit-event><div class="edit-buttons"><button>SAVE</button> <button ng-click="edit.delete()" class="delete" type="button">DELETE</button></div></form>'),e.put("app/events/partials/events.html",'<div id="events"><header ng-include="\'components/navbar/navbar.html\'"></header><md-tabs md-stretch-tabs="always"><md-tab ng-repeat="type in eventTypes" label="{{ eventTypes[$index] }}"><listing ng-repeat="event in events[type]"></listing></md-tab></md-tabs></div>'),e.put("app/listing/partials/listing.html",'<div class="listing"><div class="time"><div ng-repeat="venue in venues"><h2>{{ times[$index].startTime | date: \'shortTime\' }}</h2><h3>{{ times[$index].startTime | date: \'MMMM d\' }}</h3><p class="venue">{{ venue.name }} <a href="{{ venue.googlemaps }}" target="_blank"><span class="address">{{ venue.address }}</span> <span>(view in Google Maps)</span></a></p><a ng-href="{{ times[$index].ticketlink }}" ng-if="times[$index].ticketlink"><button>Reserve Ticket</button></a></div></div><div class="details"><div class="img" style="background-image: url({{ event.image }})"></div><div class="title"><h2>{{ event.name }}</h2></div><h3 ng-if="event.members">{{ event.members }}</h3><h3 ng-if="event.type === \'film\'">{{ event.director }} || {{ event.year }} || {{ event.duration }} minutes</h3><h3 ng-if="event.type === \'music\'"><a ng-if="event.homepage" href="{{ event.homepage }}">Homepage</a><a ng-if="event.bandcamp" href="{{ event.bandcamp }}">Bandcamp</a><a ng-if="event.faacebook" href="{{ event.facebook }}">Facebook</a></h3><p>{{ event.description}}</p></div></div>'),e.put("app/venues/partials/venues.html",'<div id="venues"><header ng-include="\'components/navbar/navbar.html\'"></header><div ng-repeat="venue in venues"><p id="{{ venue._id }}">{{ venue.name }}</p></div></div>'),e.put("app/schedule/partials/dayinschedule.html",'<listing ng-repeat="event in events track by event.startTime" event="event" listing-type="event.type"></listing>'),e.put("app/schedule/partials/schedule.html",'<div id="schedule"><header ng-include="\'components/navbar/navbar.html\'"></header><md-tabs md-stretch-tabs="always"><md-tab md-noink="" label="Thursday - 16th"><day-in-schedule events="events" date="16"></day-in-schedule></md-tab><md-tab label="Friday - 17th"><day-in-schedule events="events" date="17"></day-in-schedule></md-tab><md-tab label="Saturday - 18th"><day-in-schedule events="events" date="18"></day-in-schedule></md-tab></md-tabs></div>')}]);